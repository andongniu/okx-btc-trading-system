# 📊 自主交易策略详细文档

## 🎯 策略概览

### 基本信息
- **策略名称**: 趋势跟踪 + 均值回归混合策略
- **运行时间**: 2026-02-25 开始
- **账户资金**: $200.00 USDT
- **交易品种**: BTC/USDT:USDT (OKX永续合约)
- **合约规格**: 1合约 = 0.01 BTC
- **最小交易**: 0.01合约 = 0.0001 BTC ≈ $6.5

### 核心目标
- **月目标**: 200U → 400U (+100%)
- **风险控制**: 单笔最大风险1%
- **盈亏比**: >1.5:1
- **胜率目标**: >55%

## 🔧 技术架构

### 系统组件
```
1. 📊 自主交易引擎 (continuous_autonomous_trader.py)
   - 市场分析模块
   - 信号生成模块
   - 风险计算模块
   - 订单执行模块

2. 🔔 交易通知器 (trade_notifier.py)
   - 持仓监控
   - Telegram通知
   - 状态检查

3. 🌐 监控面板 (working_monitor.py @ 8084)
   - 实时数据显示
   - 交易历史查看
   - 系统状态监控
```

### 数据流
```
市场数据 (OKX API)
    ↓ 15分钟K线
技术指标计算
    ↓ 趋势/波动率分析
信号生成逻辑
    ↓ 风险参数计算
订单执行 (带止盈止损)
    ↓ 交易记录保存
Telegram通知 + 监控面板更新
```

## 📈 技术指标系统

### 1. 趋势判断指标
```python
# 移动平均线系统
- SMA_20: 20周期简单移动平均线
- SMA_50: 50周期简单移动平均线
- 趋势判断逻辑:
  * 上涨趋势: 价格 > SMA_20 > SMA_50
  * 下跌趋势: 价格 < SMA_20 < SMA_50  
  * 震荡趋势: 其他情况

# 支撑阻力系统
- 支撑位: 最近20周期最低价
- 阻力位: 最近20周期最高价
- 价格位置: (当前价-支撑)/(阻力-支撑)
```

### 2. 波动率指标
```python
# 年化波动率计算
- 数据源: 100根15分钟K线
- 收益率计算: (close[t] - close[t-1]) / close[t-1]
- 标准差: np.std(returns)
- 年化波动率: std * sqrt(365*24*4)  # 15分钟数据

# 波动率分级
- 低波动率: < 40% (年化)
- 中波动率: 40%-80% (年化)  
- 高波动率: > 80% (年化)
```

### 3. 价格位置分析
```python
# 支撑阻力区间
- 强支撑区: 价格位置 < 30%
- 中性区: 价格位置 30%-70%
- 强阻力区: 价格位置 > 70%

# 理想入场位置
- 多头: 价格在强支撑区 (<30%)
- 空头: 价格在强阻力区 (>70%)
```

## 🎯 交易信号逻辑

### 策略1: 趋势跟踪 (主策略)
```python
# 多头信号条件 (必须全部满足)
1. 趋势状态 = 'bullish' (上涨趋势)
2. 价格位置 < 0.3 (强支撑区)
3. 风险回报比 > 1.5
4. 波动率在可接受范围

# 空头信号条件 (必须全部满足)  
1. 趋势状态 = 'bearish' (下跌趋势)
2. 价格位置 > 0.7 (强阻力区)
3. 风险回报比 > 1.5
4. 波动率在可接受范围

# 信号属性
- 信心度: 70%
- 策略标签: '趋势跟踪'
```

### 策略2: 均值回归 (辅助策略)
```python
# 适用条件
- 趋势状态 = 'neutral' (震荡趋势)
- 波动率等级 = 'high' (高波动率)

# 多头信号条件
1. 价格位置 < 0.3 (强支撑区)
2. 高波动率环境

# 空头信号条件
1. 价格位置 > 0.7 (强阻力区)  
2. 高波动率环境

# 信号属性
- 信心度: 60%
- 策略标签: '均值回归'
```

### 信号过滤条件
```python
# 冷却期过滤
- 连续亏损次数 ≥ 3 → 暂停交易
- 冷却时间: 4小时

# 交易频率限制
- 每日最大交易: 5次
- 最小交易间隔: 30分钟

# 市场条件过滤
- 极端波动率 (>100%) → 暂停交易
- 流动性不足 → 暂停交易
- 系统错误 → 暂停交易
```

## ⚖️ 风险管理体系

### 1. 仓位管理
```python
# 风险计算
单笔风险金额 = 账户总额 × 1%
仓位价值 = 风险金额 ÷ (止损百分比 ÷ 100)
合约数量 = 仓位价值 ÷ (当前价格 × 0.01)

# 仓位限制
最小仓位: 0.01合约 ($6.5)
最大仓位: 0.10合约 ($65)
实际仓位: 在最小和最大之间
```

### 2. 动态参数调整
```python
# 根据波动率调整参数
if 波动率 == 'low':
    止损百分比 = 1.2%
    止盈百分比 = 2.4%
    杠杆倍数 = 15x
elif 波动率 == 'medium':
    止损百分比 = 1.5%  
    止盈百分比 = 3.0%
    杠杆倍数 = 10x
else:  # high
    止损百分比 = 2.0%
    止盈百分比 = 4.0%
    杠杆倍数 = 5x
```

### 3. 止盈止损计算
```python
# 多头仓位
止损价 = 入场价 × (1 - 止损百分比 ÷ 100)
止盈价 = 入场价 × (1 + 止盈百分比 ÷ 100)

# 空头仓位  
止损价 = 入场价 × (1 + 止损百分比 ÷ 100)
止盈价 = 入场价 × (1 - 止盈百分比 ÷ 100)

# 风险回报比
风险回报比 = 止盈百分比 ÷ 止损百分比
最小要求: > 1.5
```

### 4. 多层风控
```python
# 仓位级风控
- 单笔最大亏损: 1% ($2)
- 单笔最大回撤: 止损百分比

# 日级风控  
- 每日最大亏损: 6% ($12)
- 每日最大交易: 5次
- 连续亏损暂停: 3次

# 总级风控
- 总回撤限制: 20% ($40)
- 紧急停止线: 资金 < $180
```

## 🔄 交易执行流程

### 步骤1: 市场分析 (每60秒)
```python
1. 获取100根15分钟K线
2. 计算技术指标:
   - SMA_20, SMA_50
   - 支撑位, 阻力位
   - 价格位置
   - 年化波动率
3. 判断趋势状态
4. 评估市场条件
```

### 步骤2: 信号生成
```python
1. 检查交易限制:
   - 冷却期状态
   - 每日交易次数
   - 持仓状态
2. 应用策略逻辑:
   - 趋势跟踪策略
   - 均值回归策略
3. 生成交易信号:
   - 方向 (LONG/SHORT)
   - 信心度
   - 策略标签
   - 交易原因
```

### 步骤3: 风险计算
```python
1. 根据波动率确定参数:
   - 止损百分比
   - 止盈百分比  
   - 杠杆倍数
2. 计算仓位大小:
   - 风险金额 = 1% × 账户余额
   - 仓位价值计算
   - 合约数量计算
3. 验证风险回报比:
   - 必须 > 1.5
   - 否则拒绝交易
```

### 步骤4: 订单执行
```python
1. 设置杠杆倍数
2. 执行市价订单:
   - 多头: create_market_buy_order()
   - 空头: create_market_sell_order()
3. 记录交易信息:
   - 订单ID
   - 入场价格
   - 止盈止损价格
   - 所有参数保存到日志
```

### 步骤5: 监控和通知
```python
1. 发送Telegram通知:
   - 开仓通知 (立即)
   - 包含所有交易详情
2. 更新监控面板:
   - 实时持仓显示
   - 账户余额更新
   - 交易历史记录
3. 持续监控:
   - 每30秒检查持仓状态
   - 止盈止损触发监控
   - 平仓通知发送
```

## 📊 参数配置详情

### 核心参数
```yaml
交易参数:
  检查间隔: 60秒
  最小仓位: 0.01合约
  最大仓位: 0.10合约
  单笔风险: 1%
  每日最大交易: 5次
  连续亏损暂停: 3次

波动率参数:
  低波动率阈值: < 40%
  中波动率阈值: 40%-80%
  高波动率阈值: > 80%

低波动率设置:
  止损: 1.2%
  止盈: 2.4%
  杠杆: 15x
  风险回报比: 2.0:1

中波动率设置:
  止损: 1.5%
  止盈: 3.0%
  杠杆: 10x
  风险回报比: 2.0:1

高波动率设置:
  止损: 2.0%
  止盈: 4.0%
  杠杆: 5x
  风险回报比: 2.0:1
```

### 技术指标参数
```yaml
移动平均线:
  SMA周期1: 20 (短期趋势)
  SMA周期2: 50 (长期趋势)

支撑阻力:
  观察周期: 20
  支撑位: 周期内最低价
  阻力位: 周期内最高价

波动率计算:
  K线周期: 15分钟
  数据数量: 100根
  年化因子: sqrt(365*24*4)
```

## 🎯 策略优势

### 1. 动态适应性
```
✅ 根据波动率自动调整参数
✅ 不同市场环境使用不同策略
✅ 风险参数实时优化
✅ 仓位大小动态计算
```

### 2. 严格风控
```
✅ 多层风险控制体系
✅ 单笔风险限制1%
✅ 每日亏损限制6%
✅ 总回撤限制20%
✅ 连续亏损暂停机制
```

### 3. 智能信号
```
✅ 多重条件过滤
✅ 趋势+均值回归混合
✅ 价格位置分析
✅ 信心度评估
```

### 4. 完整监控
```
✅ 实时Telegram通知
✅ Web监控面板
✅ 完整交易日志
✅ 系统健康检查
```

## ⚠️ 策略限制

### 市场条件限制
```
❌ 极端波动率 (>100%) 暂停交易
❌ 流动性不足时暂停交易  
❌ 系统维护期间暂停交易
❌ 网络故障时暂停交易
```

### 性能限制
```
⏱️ 每60秒分析一次市场
📊 基于15分钟K线数据
💰 最小交易单位0.01合约
⚡ 市价单执行，可能有滑点
```

### 风险提示
```
🔴 加密货币交易高风险
🔴 可能损失全部资金
🔴 杠杆交易放大风险
🔴 市场不可预测性
🔴 系统可能有bug
```

## 📈 绩效目标

### 短期目标 (第1周)
```
✅ 熟悉策略执行
✅ 验证信号质量
✅ 测试风险控制
✅ 目标: +20% ($200 → $240)
```

### 中期目标 (第2-3周)
```
📊 优化参数设置
📊 提高胜率
📊 稳定盈利
📊 目标: +45% ($240 → $290 → $340)
```

### 长期目标 (第4周)
```
🎯 实现月目标
🎯 验证策略有效性
🎯 准备规模扩大
🎯 目标: +100% ($340 → $400)
```

## 🔧 系统维护

### 日常检查
```
1. ✅ 验证交易所连接
2. ✅ 检查账户余额
3. ✅ 确认持仓状态
4. ✅ 测试通知功能
5. ✅ 监控系统日志
```

### 定期优化
```
1. 📊 分析交易绩效
2. ⚙️ 调整策略参数
3. 🔧 修复系统问题
4. 📈 更新技术指标
5. 🎯 优化风险控制
```

### 紧急处理
```
1. 🚨 检测到异常立即暂停
2. 💾 保存当前状态
3. 📱 发送紧急通知
4. 🔄 系统诊断和恢复
5. ✅ 验证后重新启动
```

## 📋 当前运行状态

### 系统状态 (2026-02-25 17:45)
```
✅ 自主交易引擎: 运行中
✅ 交易通知器: 运行中  
✅ 监控面板: http://localhost:8084
✅ Telegram通知: 已配置 (@anth6iu_noticer_bot)
✅ 交易所连接: 正常
✅ 账户状态: $200.00 USDT
✅ 持仓状态: 无持仓
✅ 市场状态: 等待交易信号
```

### 最近活动
```
📝 2026-02-25 12:06: 测试交易1 (0.01合约)
📝 2026-02-25 12:14: 测试平仓1
📝 2026-02-25 12:22: 测试交易2 (0.01合约)
📝 2026-02-25 12:51: 系统接管平仓
📝 2026-02-25 16:20: Telegram通知测试成功
📝 2026-02-25 17:30: 策略文档创建
```

### 等待条件
```
🎯 当前市场: 上涨趋势，价格位置66.81%
⏳ 等待: 价格回落到支撑区 (<30%)
📊 监控: 趋势变化和波动率
🔔 就绪: 信号生成和通知系统
```

---
**文档版本**: v1.0  
**最后更新**: 2026-02-25 17:45  
**策略状态**: ✅ 正常运行  
**监控地址**: http://localhost:8084  
**通知Bot**: @anth6iu_noticer_bot