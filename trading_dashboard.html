<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freqtrade äº¤æ˜“ç³»ç»Ÿé¢æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #f8fafc;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        .neutral {
            color: #60a5fa;
        }

        .chart-container {
            height: 300px;
            position: relative;
            margin-top: 10px;
        }

        .trade-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .trade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            border-left: 4px solid;
            transition: background 0.3s ease;
        }

        .trade-item:hover {
            background: rgba(15, 23, 42, 0.8);
        }

        .trade-item.buy {
            border-left-color: #10b981;
        }

        .trade-item.sell {
            border-left-color: #ef4444;
        }

        .trade-time {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .trade-price {
            font-weight: 600;
        }

        .trade-position {
            color: #60a5fa;
        }

        .strategy-info {
            line-height: 1.6;
        }

        .strategy-param {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .param-name {
            color: #94a3b8;
        }

        .param-value {
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .status-waiting {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #94a3b8;
            font-size: 0.9rem;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Freqtrade äº¤æ˜“ç³»ç»Ÿé¢æ¿</h1>
            <div class="subtitle">OKX BTCæ°¸ç»­åˆçº¦ | å®æ—¶ç›‘æ§ä¸æ•°æ®åˆ†æ</div>
        </div>

        <div class="dashboard-grid">
            <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</div>
                    <div class="card-icon">âš™ï¸</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalReturn">-98.92%</div>
                        <div class="stat-label">æ€»æ”¶ç›Šç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalTrades">162</div>
                        <div class="stat-label">æ€»äº¤æ˜“æ¬¡æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="initialBalance">10,000</div>
                        <div class="stat-label">åˆå§‹èµ„é‡‘ (USDT)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="finalBalance">107.98</div>
                        <div class="stat-label">æœ€ç»ˆèµ„é‡‘ (USDT)</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="strategy-param">
                        <span class="param-name">ç³»ç»ŸçŠ¶æ€</span>
                        <span class="status-badge status-waiting">ç­‰å¾…APIå¯†é’¥</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">äº¤æ˜“æ‰€</span>
                        <span class="param-value">OKX</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">äº¤æ˜“å¯¹</span>
                        <span class="param-value">BTC/USDT:USDT</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">äº¤æ˜“æ¨¡å¼</span>
                        <span class="param-value">æ°¸ç»­åˆçº¦ (Futures)</span>
                    </div>
                </div>
            </div>

            <!-- ç­–ç•¥ä¿¡æ¯ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ¯ ç­–ç•¥ä¿¡æ¯</div>
                    <div class="card-icon">ğŸ“ˆ</div>
                </div>
                <div class="strategy-info">
                    <div class="strategy-param">
                        <span class="param-name">ç­–ç•¥åç§°</span>
                        <span class="param-value">SampleStrategy</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">æ—¶é—´å‘¨æœŸ</span>
                        <span class="param-value">5åˆ†é’Ÿ</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">æŒä»“æ•°é‡</span>
                        <span class="param-value">3</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">æ¯å•é‡‘é¢</span>
                        <span class="param-value">100 USDT</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">æ­¢æŸ</span>
                        <span class="param-value">-10%</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">æœ€å°ROI</span>
                        <span class="param-value">10% (0m), 5% (30m), 2% (60m)</span>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(15, 23, 42, 0.6); border-radius: 8px;">
                        <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 8px;">ç­–ç•¥é€»è¾‘</div>
                        <div style="font-size: 0.95rem;">
                            <div>â€¢ ä¹°å…¥ä¿¡å·: RSI < 30 ä¸” ä»·æ ¼ä½äº20æ—¥å‡çº¿</div>
                            <div>â€¢ å–å‡ºä¿¡å·: RSI > 70 ä¸” ä»·æ ¼é«˜äº20æ—¥å‡çº¿</div>
                            <div>â€¢ æŠ€æœ¯æŒ‡æ ‡: RSI(14), SMA(20), SMA(50), å¸ƒæ—å¸¦(20,2)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- èµ„é‡‘æ›²çº¿ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ’° èµ„é‡‘æ›²çº¿</div>
                    <div class="card-icon">ğŸ“Š</div>
                </div>
                <div class="chart-container">
                    <canvas id="equityChart"></canvas>
                </div>
            </div>

            <!-- äº¤æ˜“ç»Ÿè®¡ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“ˆ äº¤æ˜“ç»Ÿè®¡</div>
                    <div class="card-icon">ğŸ“‹</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value positive" id="winRate">0%</div>
                        <div class="stat-label">èƒœç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgWin">0</div>
                        <div class="stat-label">å¹³å‡ç›ˆåˆ©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgLoss">0</div>
                        <div class="stat-label">å¹³å‡äºæŸ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profitFactor">0</div>
                        <div class="stat-label">ç›ˆäºæ¯”</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="strategy-param">
                        <span class="param-name">æœ€å¤§å›æ’¤</span>
                        <span class="param-value negative">-99.08%</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">å¤æ™®æ¯”ç‡</span>
                        <span class="param-value negative">-2.34</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">äº¤æ˜“é¢‘ç‡</span>
                        <span class="param-value">5.4 æ¬¡/å¤©</span>
                    </div>
                </div>
            </div>

            <!-- æœ€è¿‘äº¤æ˜“ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ”„ æœ€è¿‘äº¤æ˜“</div>
                    <div class="card-icon">ğŸ’±</div>
                </div>
                <div class="trade-list" id="recentTrades">
                    <!-- äº¤æ˜“è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>

            <!-- é£é™©æŒ‡æ ‡ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">âš ï¸ é£é™©æŒ‡æ ‡</div>
                    <div class="card-icon">ğŸš¨</div>
                </div>
                <div style="margin-top: 10px;">
                    <div class="strategy-param">
                        <span class="param-name">ç­–ç•¥å¥åº·åº¦</span>
                        <span class="status-badge status-inactive">é«˜é£é™©</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">å›æµ‹è¡¨ç°</span>
                        <span class="param-value negative">æå·® (-98.92%)</span>
                    </div>
                    <div class="strategy-param">
                        <span class="param-name">å»ºè®®æ“ä½œ</span>
                        <span class="param-value">éœ€è¦ç­–ç•¥ä¼˜åŒ–</span>
                    </div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <div style="color: #ef4444; font-size: 0.9rem; margin-bottom: 8px;">âš ï¸ é£é™©æç¤º</div>
                        <div style="font-size: 0.9rem; color: #fca5a5;">
                            â€¢ å½“å‰ç­–ç•¥å›æµ‹è¡¨ç°æå·®ï¼Œä¸å»ºè®®å®ç›˜äº¤æ˜“<br>
                            â€¢ éœ€è¦ä¼˜åŒ–ç­–ç•¥å‚æ•°æˆ–æ›´æ¢ç­–ç•¥<br>
                            â€¢ å»ºè®®è¿›è¡Œæ›´é•¿æ—¶é—´çš„å›æµ‹éªŒè¯
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>ğŸ“… æ•°æ®æ›´æ–°æ—¶é—´: <span id="updateTime">2026-02-24 00:02</span> | ğŸ”„ è‡ªåŠ¨åˆ·æ–°: 60ç§’</p>
            <p>ğŸ’¡ æç¤º: æ­¤é¢æ¿ä¸ºé™æ€å±•ç¤ºï¼Œéœ€è¦APIå¯†é’¥åæ‰èƒ½å¯åŠ¨å®æ—¶äº¤æ˜“ç³»ç»Ÿ</p>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = window.location.origin;
        
        // é»˜è®¤æ•°æ®ï¼ˆå¦‚æœAPIä¸å¯ç”¨ï¼‰
        const defaultData = {
            initial_balance: 10000,
            final_balance: 107.97809292153936,
            total_return: -98.92021907078461,
            num_trades: 162,
            trades: []
        };
        
        let backtestData = { ...defaultData };

        // æ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp * 1000);
            return date.toLocaleString('zh-CN', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // æ ¼å¼åŒ–ä»·æ ¼
        function formatPrice(price) {
            return new Intl.NumberFormat('zh-CN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(price);
        }

        // è®¡ç®—äº¤æ˜“ç»Ÿè®¡
        function calculateTradeStats(trades) {
            let wins = 0;
            let losses = 0;
            let totalWin = 0;
            let totalLoss = 0;
            
            // åˆ†æäº¤æ˜“å¯¹
            for (let i = 0; i < trades.length; i += 2) {
                if (i + 1 < trades.length) {
                    const buy = trades[i];
                    const sell = trades[i + 1];
                    const profit = (sell.balance - (i === 0 ? backtestData.initial_balance : trades[i-1].balance));
                    
                    if (profit > 0) {
                        wins++;
                        totalWin += profit;
                    } else {
                        losses++;
                        totalLoss += Math.abs(profit);
                    }
                }
            }
            
            const totalTrades = wins + losses;
            const winRate = totalTrades > 0 ? (wins / totalTrades * 100).toFixed(1) : 0;
            const avgWin = wins > 0 ? (totalWin / wins).toFixed(2) : 0;
            const avgLoss = losses > 0 ? (totalLoss / losses).toFixed(2) : 0;
            const profitFactor = totalLoss > 0 ? (totalWin / totalLoss).toFixed(2) : 0;
            
            return {
                winRate,
                avgWin,
                avgLoss,
                profitFactor,
                wins,
                losses,
                totalTrades
            };
        }

        // ç”Ÿæˆèµ„é‡‘æ›²çº¿æ•°æ®
        function generateEquityData(trades) {
            const equityData = [];
            let currentBalance = backtestData.initial_balance;
            
            // æ·»åŠ åˆå§‹ç‚¹
            equityData.push({
                x: new Date((parseInt(trades[0].timestamp) - 3600) * 1000), // äº¤æ˜“å¼€å§‹å‰1å°æ—¶
                y: currentBalance
            });
            
            // æ·»åŠ æ¯ä¸ªäº¤æ˜“åçš„èµ„é‡‘
            for (let i = 0; i < trades.length; i++) {
                const trade = trades[i];
                if (trade.type === 'sell') {
                    currentBalance = trade.balance;
                    equityData.push({
                        x: new Date(parseInt(trade.timestamp) * 1000),
                        y: currentBalance
                    });
                }
            }
            
            return equityData;
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            const ctx = document.getElementById('equityChart').getContext('2d');
            
            // ç”Ÿæˆèµ„é‡‘æ›²çº¿æ•°æ®
            const equityData = generateEquityData(backtestData.trades);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'èµ„é‡‘æ›²çº¿ (USDT)',
                        data: equityData,
                        borderColor: '#60a5fa',
                        backgroundColor: 'rgba(96, 165, 250, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#e2e8f0',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `èµ„é‡‘: ${formatPrice(context.parsed.y)} USDT`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MM-dd'
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return formatPrice(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°äº¤æ˜“åˆ—è¡¨
        function updateTradeList() {
            const container = document.getElementById('recentTrades');
            container.innerHTML = '';
            
            // æ˜¾ç¤ºæœ€è¿‘10ç¬”äº¤æ˜“
            const recentTrades = backtestData.trades.slice(-20); // æ˜¾ç¤ºæœ€è¿‘20ç¬”äº¤æ˜“ï¼ˆ10å¯¹ï¼‰
            
            for (let i = 0; i < recentTrades.length; i++) {
                const trade = recentTrades[i];
                const tradeItem = document.createElement('div');
                tradeItem.className = `trade-item ${trade.type}`;
                
                const tradeTime = formatTimestamp(trade.timestamp);
                const tradePrice = formatPrice(trade.price);
                const tradePosition = trade.position > 0 ? `${(trade.position * 100).toFixed(2)}%` : 'å¹³ä»“';
                
                tradeItem.innerHTML = `
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">
                            ${trade.type === 'buy' ? 'ğŸŸ¢ ä¹°å…¥' : 'ğŸ”´ å–å‡º'} BTC
                        </div>
                        <div class="trade-time">${tradeTime}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="trade-price">${tradePrice} USDT</div>
                        <div class="trade-position">${tradePosition}</div>
                    </div>
                `;
                
                container.appendChild(tradeItem);
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const stats = calculateTradeStats(backtestData.trades);
            
            document.getElementById('totalReturn').textContent = `${backtestData.total_return.toFixed(2)}%`;
            document.getElementById('totalReturn').className = `stat-value ${backtestData.total_return >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('totalTrades').textContent = backtestData.num_trades;
            document.getElementById('initialBalance').textContent = formatPrice(backtestData.initial_balance);
            document.getElementById('finalBalance').textContent = formatPrice(backtestData.final_balance);
            
            document.getElementById('winRate').textContent = `${stats.winRate}%`;
            document.getElementById('avgWin').textContent = formatPrice(stats.avgWin);
            document.getElementById('avgLoss').textContent = formatPrice(stats.avgLoss);
            document.getElementById('profitFactor').textContent = stats.profitFactor;
            
            // æ›´æ–°èƒœç‡é¢œè‰²
            document.getElementById('winRate').className = `stat-value ${stats.winRate > 50 ? 'positive' : stats.winRate > 30 ? 'neutral' : 'negative'}`;
            
            // æ›´æ–°ç›ˆäºæ¯”é¢œè‰²
            document.getElementById('profitFactor').className = `stat-value ${stats.profitFactor > 1.5 ? 'positive' : stats.profitFactor > 1 ? 'neutral' : 'negative'}`;
        }

        // ä»APIè·å–æ•°æ®
        async function fetchData() {
            try {
                // è·å–ç³»ç»ŸçŠ¶æ€
                const statusResponse = await fetch(`${API_BASE_URL}/api/system-status`);
                const statusData = await statusResponse.json();
                
                // è·å–å›æµ‹ç»“æœ
                const backtestResponse = await fetch(`${API_BASE_URL}/api/backtest-results`);
                const backtestResult = await backtestResponse.json();
                
                // è·å–æœ€è¿‘äº¤æ˜“
                const tradesResponse = await fetch(`${API_BASE_URL}/api/recent-trades`);
                const tradesData = await tradesResponse.json();
                
                // è·å–èµ„é‡‘æ›²çº¿
                const equityResponse = await fetch(`${API_BASE_URL}/api/equity-curve`);
                const equityData = await equityResponse.json();
                
                // æ›´æ–°æ•°æ®
                backtestData = {
                    initial_balance: backtestResult.initial_balance || defaultData.initial_balance,
                    final_balance: backtestResult.final_balance || defaultData.final_balance,
                    total_return: backtestResult.total_return || defaultData.total_return,
                    num_trades: backtestResult.num_trades || defaultData.num_trades,
                    trades: backtestResult.trades || defaultData.trades
                };
                
                // æ›´æ–°UI
                updateSystemStatus(statusData);
                updateStats();
                updateTradeList(tradesData.recent_trades || []);
                updateEquityChart(equityData.equity_curve || []);
                
                // æ›´æ–°æ—¶é—´æ˜¾ç¤º
                document.getElementById('updateTime').textContent = new Date().toLocaleString('zh-CN');
                
                return true;
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                updateStats();
                initCharts();
                updateTradeList();
                return false;
            }
        }
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€
        function updateSystemStatus(statusData) {
            const system = statusData.system;
            const performance = statusData.performance;
            
            // æ›´æ–°çŠ¶æ€å¾½ç« 
            const statusBadge = document.querySelector('.status-badge');
            if (system.status === 'active') {
                statusBadge.className = 'status-badge status-active';
                statusBadge.textContent = 'è¿è¡Œä¸­';
            } else if (system.status === 'waiting') {
                statusBadge.className = 'status-badge status-waiting';
                statusBadge.textContent = 'ç­‰å¾…APIå¯†é’¥';
            } else {
                statusBadge.className = 'status-badge status-inactive';
                statusBadge.textContent = 'å·²åœæ­¢';
            }
            
            // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
            document.getElementById('totalReturn').textContent = `${performance.total_return.toFixed(2)}%`;
            document.getElementById('totalReturn').className = `stat-value ${performance.total_return >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('totalTrades').textContent = performance.total_trades;
        }
        
        // æ›´æ–°èµ„é‡‘æ›²çº¿å›¾è¡¨
        function updateEquityChart(equityCurve) {
            if (!equityCurve || equityCurve.length === 0) return;
            
            const ctx = document.getElementById('equityChart').getContext('2d');
            
            // å¦‚æœå›¾è¡¨å·²å­˜åœ¨ï¼Œé”€æ¯å®ƒ
            if (window.equityChart) {
                window.equityChart.destroy();
            }
            
            const chartData = equityCurve.map(point => ({
                x: new Date(point.timestamp * 1000),
                y: point.balance
            }));
            
            window.equityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'èµ„é‡‘æ›²çº¿ (USDT)',
                        data: chartData,
                        borderColor: '#60a5fa',
                        backgroundColor: 'rgba(96, 165, 250, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#e2e8f0',
                            borderColor: 'rgba(148, 163, 184, 0.2)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `èµ„é‡‘: ${formatPrice(context.parsed.y)} USDT`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MM-dd'
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return formatPrice(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°äº¤æ˜“åˆ—è¡¨
        function updateTradeList(trades = null) {
            const container = document.getElementById('recentTrades');
            container.innerHTML = '';
            
            const tradeList = trades || backtestData.trades.slice(-20);
            
            if (tradeList.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">æš‚æ— äº¤æ˜“è®°å½•</div>';
                return;
            }
            
            for (let i = 0; i < tradeList.length; i++) {
                const trade = tradeList[i];
                const tradeItem = document.createElement('div');
                tradeItem.className = `trade-item ${trade.type}`;
                
                const tradeTime = formatTimestamp(trade.timestamp);
                const tradePrice = formatPrice(trade.price);
                const tradePosition = trade.position > 0 ? `${(trade.position * 100).toFixed(2)}%` : 'å¹³ä»“';
                
                tradeItem.innerHTML = `
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">
                            ${trade.type === 'buy' ? 'ğŸŸ¢ ä¹°å…¥' : 'ğŸ”´ å–å‡º'} BTC
                        </div>
                        <div class="trade-time">${tradeTime}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="trade-price">${tradePrice} USDT</div>
                        <div class="trade-position">${tradePosition}</div>
                    </div>
                `;
                
                container.appendChild(tradeItem);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('updateTime').textContent = 'åŠ è½½ä¸­...';
            
            // é¦–æ¬¡åŠ è½½æ•°æ®
            await fetchData();
            
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
            setInterval(async () => {
                await fetchData();
            }, 30000);
        });
